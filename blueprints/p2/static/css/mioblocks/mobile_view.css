/* Mobile/Tablet Responsive */
@media (max-width: 1024px) {
    /* Dark surface + typography */
    body {
        background:
            radial-gradient(120% 120% at 20% 20%, rgba(22, 163, 144, 0.08), transparent 48%),
            radial-gradient(110% 110% at 80% 0%, rgba(234, 179, 8, 0.06), transparent 44%),
            linear-gradient(160deg, #0c111a 0%, #0b1018 35%, #0a0c14 100%);
        color: #e1e3e5;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
        min-height: 100vh;
    }

    .page-shell {
        width: 100%;
        padding: 0 12px 28px;
        margin: 0 auto;
    }

    .sticky-header {
        background:
            radial-gradient(120% 140% at 12% 0%, rgba(20, 184, 166, 0.12), transparent 42%),
            radial-gradient(120% 140% at 88% -10%, rgba(234, 179, 8, 0.10), transparent 38%),
            linear-gradient(145deg, #0f1722 0%, #0d141e 40%, #0b1018 100%);
        padding: 16px;
        margin: 0 -12px 12px;
        border-radius: 0 0 14px 14px;
        border: 1px solid rgba(255, 255, 255, 0.03);
        box-shadow: 0 16px 32px rgba(0, 0, 0, 0.28), 0 0 0 1px rgba(20, 184, 166, 0.06);
    }

    .sticky-header > .flex {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
    }

    .sticky-header button {
        width: 100%;
        justify-content: center;
    }

    .reading-mode-toggle,
    .save-document-btn,
    .back-btn {
        padding: 8px 12px;
        font-size: 14px;
        min-height: 40px;
        display: flex;
        align-items: center;
    }

    .reading-mode-toggle .shortcut-hint {
        display: none;
    }

    .document-title-input {
        width: 100%;
        font-size: 16px;
    }

    /* Layout stacks main + annotations */
    .block-row {
        flex-direction: column;
        gap: 12px;
        min-height: auto !important;
        max-height: none !important;
        padding: 10px;
        margin-bottom: 16px;
        position: relative;
        z-index: 1;
    }

    .block-row.dynamic-height {
        min-height: auto;
        max-height: none;
    }

    .main-block-column,
    .block-row .main-block-column {
        width: 100% !important;
        min-width: 0;
        position: relative;
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
    }

    .block-row.dynamic-height .main-block-column {
        min-height: auto !important;
        max-height: none !important;
        height: auto !important;
    }

    .block-row .annotation-column,
    .annotation-column {
        width: 100% !important;
        min-width: 0;
        position: relative;
        flex-shrink: 0;
        min-height: 360px !important;
        max-height: 420px !important;
        margin-top: 12px;
        background: rgba(10, 14, 20, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 12px;
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
    }

    .main-block-column .block-item,
    .annotation-column .annotation-block {
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
        margin-bottom: 0;
        overflow: hidden;
        height: 100%;
    }

    .block-row.dynamic-height .block-item,
    .block-row.dynamic-height .annotation-block {
        height: auto;
    }

    /* Keep editors from collapsing when parent height is auto */
    .block-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
    }

    .block-row.dynamic-height .block-content {
        flex: 1 1 auto;
        height: auto;
        overflow: visible;
    }

    .toastui-editor-defaultUI,
    .markdown-editor,
    .editorjs-editor,
    .code-editor-wrapper,
    .markdown-editor-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .block-row.dynamic-height .toastui-editor-defaultUI,
    .block-row.dynamic-height .markdown-editor,
    .block-row.dynamic-height .editorjs-editor,
    .block-row.dynamic-height .code-editor-wrapper,
    .block-row.dynamic-height .markdown-editor-wrapper {
        flex: 1 1 auto;
        height: auto;
    }

    /* Annotation layout - Matching desktop tabbed interface */
    .annotation-scroll-wrapper {
        display: flex;
        flex-direction: column;
        overflow: hidden;
        height: 100%;
    }

    /* Tabs wrapper - header with add button + tabs */
    .annotation-tabs-wrapper {
        display: flex;
        align-items: flex-end;
        background: linear-gradient(180deg, #1f232c 0%, #151821 100%);
        border: 1px solid #2a2c31;
        border-radius: 10px 10px 0 0;
        box-shadow: inset 0 -1px 0 #1f2a35;
        flex-shrink: 0;
        position: relative;
        overflow: hidden;
    }

    /* Add annotation button */
    .annotation-tab-add {
        background: rgba(20, 184, 166, 0.08);
        border: none;
        border-right: 1px solid #2a2c31;
        color: #0af5d4;
        padding: 10px 12px;
        cursor: pointer;
        transition: all 0.15s ease;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        width: 44px;
        height: 100%;
        position: relative;
        z-index: 5;
    }

    .annotation-tab-add:active {
        background: rgba(20, 184, 166, 0.15);
        color: #14b8a6;
    }

    .annotation-tab-add i {
        font-size: 16px;
    }

    /* Tabs container */
    .annotation-tabs {
        display: flex;
        align-items: flex-end;
        gap: 6px;
        padding: 8px 8px 0 8px;
        overflow-x: auto;
        overflow-y: hidden;
        flex: 1;
        min-width: 0;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: #14b8a6 #0d0e10;
        position: relative;
    }

    .annotation-tabs::-webkit-scrollbar {
        height: 6px;
    }

    .annotation-tabs::-webkit-scrollbar-thumb {
        background: #14b8a6;
        border-radius: 999px;
    }

    /* Individual tab styling */
    .annotation-tab {
        background: transparent;
        border: 1px solid transparent;
        color: #a7adb7;
        padding: 10px 14px;
        cursor: pointer;
        transition: all 0.15s ease;
        font-size: 12px;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 8px;
        flex-shrink: 0;
        position: relative;
        border-radius: 8px 8px 0 0;
        margin-bottom: -1px;
        min-width: 100px;
        max-width: 180px;
    }

    .annotation-tab:active {
        background: rgba(42, 44, 49, 0.65);
        border-color: #2c3847;
        color: #e1e3e5;
    }

    /* Active tab */
    .annotation-tab.active {
        background: #2a2f3a;
        border-color: #2c3847;
        color: #0af5d4;
        font-weight: 600;
        box-shadow: inset 0 -2px 0 #14b8a6, 0 6px 14px rgba(0, 0, 0, 0.25);
        z-index: 3;
    }

    .annotation-tab span {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .annotation-tab span.empty-title {
        font-style: italic;
        opacity: 0.6;
    }

    /* Tab close button */
    .annotation-tab-close {
        margin-left: 4px;
        padding: 4px;
        border-radius: 4px;
        opacity: 0.6;
        transition: all 0.15s ease;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .annotation-tab.active .annotation-tab-close {
        opacity: 0.8;
    }

    .annotation-tab-close:active {
        opacity: 1 !important;
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
    }

    /* Content wrapper */
    .annotation-content-wrapper {
        flex: 1;
        overflow: hidden;
        position: relative;
        display: flex;
        flex-direction: column;
        background: rgba(10, 14, 20, 0.9);
        border: 1px solid #2a2c31;
        border-top: none;
        border-radius: 0 10px 10px 10px;
        padding: 0;
        box-shadow: 0 16px 40px rgba(0, 0, 0, 0.35);
        height: 100%;
    }

    /* Individual annotation card */
    .annotation-card {
        display: none;
        flex-direction: column;
        height: 100%;
        overflow: hidden;
    }

    .annotation-card.active {
        display: flex;
    }

    .annotation-card .block-item {
        height: 100%;
        border-radius: 0;
        border-bottom-left-radius: 10px;
        border-bottom-right-radius: 10px;
    }

    .annotation-card .block-item .block-header {
        background: #2a2f3a;
        border-bottom: 1px solid #2c3847;
        border-radius: 0;
    }

    /* Hide mobile toggle button and nav controls */
    .annotation-column.mobile-hidden {
        display: none;
    }

    .mobile-annotations-toggle {
        display: none;
    }

    .annotation-nav-controls {
        display: none !important;
    }

    /* Hide resize zone on mobile */
    .resize-zone {
        display: none;
    }

    /* Block header: two-row grid */
    .block-header {
        display: grid;
        grid-template-columns: auto auto auto 1fr auto;
        grid-template-rows: auto auto;
        align-items: center;
        column-gap: 8px;
        row-gap: 8px;
        padding: 10px 12px;
        background: linear-gradient(180deg, #2b313b 0%, #21262f 100%);
        border: 1px solid rgba(44, 56, 71, 0.9);
        border-bottom: 1px solid #1f2a35;
        border-radius: 9px 9px 0 0;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
    }

    .drag-handle {
        grid-column: 1;
        grid-row: 1;
    }

    .collapse-btn {
        grid-column: 2;
        grid-row: 1;
    }

    .block-header > i,
    .block-type-label {
        grid-column: 3;
        grid-row: 1;
    }

    .block-title-input {
        grid-column: 4;
        grid-row: 1;
        width: 100%;
        text-align: left;
        background: rgba(10, 14, 20, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.05);
        color: #e1e3e5;
        padding: 8px 10px;
        border-radius: 6px;
        font-size: 14px;
        min-width: 0;
    }

    .block-title-input:focus {
        background: rgba(10, 14, 20, 0.6);
        border-color: #14b8a6;
        outline: none;
    }

    .language-selector {
        grid-column: 5;
        grid-row: 1;
        justify-self: end;
    }

    .block-controls {
        grid-column: 1 / 6;
        grid-row: 2;
        display: flex;
        flex-direction: row !important;
        align-items: center;
        justify-content: flex-start;
        gap: 8px;
        width: 100%;
        margin-left: 0;
        flex-wrap: nowrap !important;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        white-space: nowrap;
    }

    .block-controls .hover-reveal {
        opacity: 1;
        pointer-events: auto;
    }

    .block-controls .control-btn,
    .block-controls .annotation-visibility-chip {
        padding: 6px 8px;
        font-size: 13px;
        display: inline-flex !important;
        align-items: center;
        justify-content: center;
        flex: 0 0 auto;
    }

    /* Keep overflow dropdown hidden on mobile */
    .block-controls .overflow-dropdown {
        display: none !important;
    }

    /* Hide overflow menu on mobile; show all controls inline */
    .block-controls .overflow-menu-btn {
        display: none !important;
    }

    /* Insert separators stay visible and centered */
    .insert-separator {
        padding: 4px 0;
        margin: 4px 0;
        gap: 10px;
    }

    .insert-separator-line {
        opacity: 0.35;
        background: linear-gradient(90deg, #3d4047, transparent);
    }

    .insert-separator-trigger {
        opacity: 1;
        background: #16181c;
        border: 1px solid #3d4047;
        color: #a7adb7;
        padding: 6px 12px;
    }

    .insert-separator:hover .insert-separator-line,
    .insert-separator:hover .insert-separator-trigger {
        opacity: 1;
    }
}
