<!-- Notes Section Cards - For HTMX Rearrangement -->
{% for note in notes %}
<div class="col d-flex">
  <div class="card flex-fill h-100 shadow-sm item-card" data-type="proprietary_note" data-id="{{ note.id }}" data-note-description="{{ note.description_readable if note.description_readable else ('' if ((note.description or '').strip().startswith('[') or (note.description or '').strip().startswith('{')) else (note.description or '')) }}" data-is-public="{{ '1' if note.is_public else '0' }}" data-is-pinned="{{ '1' if note.is_pinned else '0' }}">
    <div class="badge-container">
      {% if note.is_pinned %}
      <span class="pin-badge" title="Pinned"><i class="material-icons" aria-hidden="true">push_pin</i><span class="visually-hidden">Pinned</span></span>
      {% endif %}
      {% if note.is_public %}
      <span class="public-badge"><i class="material-icons" aria-hidden="true">public</i><span class="visually-hidden">Public</span></span>
      {% endif %}
    </div>
    <div class="card-body d-flex flex-column item-body" tabindex="0">
      <h5 class="card-title">
        <a href="{{ url_for('notes.edit_note', note_id=note.id) }}" class="item-link">{{ note.title }}</a>
      </h5>

      {% if note.descriptions and display_prefs.show_previews %}
      <div class="note-description content-preview mb-2">
        <i class="fas fa-info-circle me-1" style="color: var(--accent-green); font-size: 0.875rem;"></i>
        <div class="d-flex flex-column">
          {% for key, val in note.descriptions %}
            <div class="d-flex align-items-start gap-2 small">
              <span class="badge rounded-pill bg-secondary">{{ key }}</span>
              <span class="text-muted">{{ val }}</span>
            </div>
          {% endfor %}
        </div>
      </div>
      {% elif note.description and display_prefs.show_previews and note.description_parse_failed %}
      <div class="note-description content-preview mb-2 text-warning small">
        ⚠️ Description exists but is not in the expected JSON format. Check server logs.
      </div>
      {% endif %}

      {% if display_prefs.show_previews %}
      <div class="card-text overflow-auto hide-scrollbar flex-grow-1 mb-3 content-preview" style="max-height: 200px;">
        {{ note.content_html | safe }}
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endfor %}
