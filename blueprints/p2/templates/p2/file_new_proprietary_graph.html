<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Graph Workspace</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme_colors_carbon_teal.css') }}">
  <style>
    body { background: var(--bg); color: var(--white); }
    .card-bg { background: var(--card); border: 1px solid var(--border-primary); border-radius: 12px; }
    .btn-accent { background: var(--accent); color: var(--white); border: none; }
    .btn-accent:hover { background: var(--accent-strong); }
  </style>
</head>
<body class="py-5">
  <div class="container" style="max-width: 820px;">
    <div class="card-bg p-4 mb-3">
      <h2 class="mb-3">Create Graph Workspace</h2>
      <p class="text-muted mb-0">Graphs are infinite canvases of linked nodes that can attach any file or folder. You can adjust layout later in the graph editor.</p>
    </div>

    <div class="card-bg p-4">
      <form id="graph-form" method="POST" action="{{ url_for('file.new_file', file_type='proprietary_graph') }}">
        <div class="mb-3">
          <label for="title" class="form-label">Title</label>
          <input type="text" class="form-control" id="title" name="title" value="Graph Workspace" required>
        </div>
        <div class="mb-3">
          <label for="description" class="form-label">Description (optional)</label>
          <textarea class="form-control" id="description" name="description" rows="2" placeholder="What is this graph about?"></textarea>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="is_public" name="is_public">
          <label class="form-check-label" for="is_public">Make graph public (view-only)</label>
        </div>
        <input type="hidden" name="content" id="content">
        <div class="d-flex justify-content-end gap-2">
          <a class="btn btn-secondary" href="{{ url_for('folders.view_folder', folder_id=session.get('current_folder_id')) }}">Cancel</a>
          <button type="button" id="create-graph-btn" class="btn btn-accent">Create Graph</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Seed default layout so storage tracking has a baseline snapshot.
    const defaultLayout = { nodes: [], edges: [], settings: {}, metadata: {} };
    document.getElementById('content').value = JSON.stringify(defaultLayout);

    // Explicitly submit on click to avoid any accidental prevention from outer listeners.
    const graphForm = document.getElementById('graph-form');
    const createBtn = document.getElementById('create-graph-btn');
    if (graphForm && createBtn) {
      createBtn.addEventListener('click', () => {
        graphForm.requestSubmit();
      });
    }
  </script>
</body>
</html>
